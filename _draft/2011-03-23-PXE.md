---
layout: post
title: PXE Booting
categories:
- it
---
Есть у меня загрузочная флешка на которой собраны несколько инструментов для загрузки Live систем. Knoppix, Slax, Alkid, Дистрибутив Windows XP SP3 и т. д.

Однажды я пришёл на работу без этой флешки. И возникла идея использовать встроенную фичу большинства сетевых плат - загрузку по сети, так называемую технологию PXE.

Идея заключается в том что при загрузке компьютера активизируется загрузчик сетевой карты и обращается к DHCP серверу, получает код загрузки по TFTP и загружает загрузчик в оперативную память. Возникает окно выбора загрузки ОС по сети. После выбора ОС происходит загрузка ос по NFS или SAMBA.

Нам понадобится DHCP-сервер, TFTP-сервер и NFS или SAMBA сервера.

Два первых сервера у меня уже были - всё строилось на FreeBSD 8.1 которая у нас работает как шлюз между нами и внешним миром. Это кстати один из минусов - загрузка по сети требует большого канала и когда начинается загрузка по сети, есть возможность того что скорость обмена данными между другими участниками и шлюзом сильно снизится.

В качестве загружаемых систем у нас будут использоваться Trinity, Partion Magic, FreeBSD booting и CloneZilla.
Самые продвинутые меня тут же спросят - зачем мне столько одинаковых дистрибутивов, которые выполняют практически одинаковые задачи?

Отвечаю - это Unix-way. Каздой задаче нужен свой инструмент. Trinity - прекрасный инструмент для решения Windows-проблем. Partion Magic - полноценный linux для поиска и решения не тривиальных проблем. FreeBSD booting - загрузка минималього окружения для начала установки FreeBSD. CloneZilla - готовый инструмент для копирования уже установленных систем.

С целями разобрались - начнём всё это реализовывать.

Первое что нам понадобится - это DHCP-сервер. В FreeBSD это `ics-dhcp`. Устонавливается через систему портов:

{% highlight %}
# cd /usr/ports/net/ics-dhcp
# make install clean
{% endhighlight %}

Для его настройки я использую `webmin` но можно настроить и через конфигурационные файлы.

Вот содержимое моего конфига:

{% highlight %}
# cd /usr/ports/net/ics-dhcp
# make install clean
{% endhighlight %}


Во вторую очередь нам понадобится TFTP-сервер - он устонавливается по умолчаию и включается простым раскоментироваием строчки в `/etc/inetd.conf`. Там же можно и настроить корневую папку этого сервера.

Пункт третий - создание загрузчика. По сути это простое копирование файлов немного модифицированных файлов стадартного загрузчика linux/unix. Существует даже целый проект `syslinux` с сайта которого можно скачать всё необходимое.

Нас интересует сам загрузчик и несколько файлов, ответственных за формирование меню.

В корневой папке tftpd созаем папку pxeboot.cfg, а внутри этой папки файл с именем default